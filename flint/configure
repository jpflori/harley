#!/bin/sh

PREFIX="/usr/local"

usage()
{
   echo "Usage: ./configure <options> <args>"
   echo "   where <options> may be"
   echo "     -h display usage information"
   echo "   where <args> may be:"
   echo "     --prefix=<path>    Specify path to installation location"
   echo "     CC=<name>          Use the C compiler with the given name"
   echo "     AR=<name>          Use the AR library builder with the given name"
   echo "     CFLAGS=<flags>     Pass the given flags to the compiler"
}

until [ -z "$1" ]; do
   case $1 in
      "-h") usage
         exit 0
         ;;
      "--prefix="*)
         PREFIX=`expr substr "$1" 10 length "$1"`
         ;;
      "AR="*)
         AR=`expr substr "$1" 4 length "$1"`
         ;;
      "CC="*)
         CC=`expr substr "$1" 4 length "$1"`
         ;;
      "CFLAGS="*)
         CFLAGS=`expr substr "$1" 8 length "$1"`
         ;;
      *) usage
         exit 1
         ;;
   esac
   shift
done

if [ -z "$CFLAGS" ]; then
   CFLAGS="-O2 -g -ansi -pedantic -Wall -funroll-loops"
fi

if [ -z "$CC" ]; then
   CC=gcc
fi

if [ -z "$CXX" ]; then
   CXX=g++
fi

CFLAGS="$CFLAGS $REENTER -DFLINT_CPIMPORT=\\\"${PREFIX}/share/flint/CPimport.txt\\\""

POINTS=points
POINTS_DENSE=points_dense

echo "# This file is autogenerated by ./configure -- do not edit!" > Makefile
echo "" >> Makefile
echo "CC=$CC" >> Makefile
echo "CXX=$CXX" >> Makefile
echo "CFLAGS=$CFLAGS" >> Makefile
echo "PREFIX=$PREFIX" >> Makefile
echo "" >> Makefile
echo "POINTS=$POINTS" >> Makefile
echo "POINTS_DENSE=$POINTS_DENSE" >> Makefile
echo "" >> Makefile

cat Makefile.in >> Makefile

