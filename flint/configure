#!/bin/sh

# (C) 2007, Robert Bradshaw, William Hart, William Stein, Michael Abshoff
# (C) 2011, William Hart

PREFIX="/usr/local"
MPIR_DIR="/usr"
MPFR_DIR="/usr"
NTL_DIR="/usr"
FLINT_DIR="/usr"
FLINT_CPIMPORT_DIR="$PREFIX/share/flint"
FLINT_CPIMPORT="$FLINT_CPIMPORT_DIR/CPimport.txt"
WANT_NTL=0

usage()
{
   echo "Usage: ./configure <options> <args>"
   echo "   where <options> may be"
   echo "     -h display usage information"
   echo "   where <args> may be:"
   echo "     --with-mpir=<path> Specify location of MPIR"
   echo "     --with-mpfr=<path> Specify location of MPFR"
   echo "     --with-ntl=<path>  Specify location of NTL and build NTL interface"
   echo "     --prefix=<path>    Specify path to installation location"
   echo "     CC=<name>          Use the C compiler with the given name"
   echo "     AR=<name>          Use the AR library builder with the given name"
   echo "     CFLAGS=<flags>     Pass the given flags to the compiler"
}

until [ -z "$1" ]; do
   case $1 in
      "-h") usage
         exit 0
         ;;
      "--with-mpir="*)
         MPIR_DIR=`expr substr "$1" 13 length "$1"`
         ;;
      "--with-mpfr="*)
         MPFR_DIR=`expr substr "$1" 13 length "$1"`
         ;;
      "--with-ntl="*)
         NTL_DIR=`expr substr "$1" 12 length "$1"`
         ;;
      "--with-flint="*)
         FLINT_DIR=`expr substr "$1" 14 length "$1"`
         ;;
      "--prefix="*)
         PREFIX=`expr substr "$1" 10 length "$1"`
         FLINT_CPIMPORT_DIR="$PREFIX/share/flint"
         FLINT_CPIMPORT="$FLINT_CPIMPORT_DIR/CPimport.txt"
	 ;;
      "AR="*)
         AR=`expr substr "$1" 4 length "$1"`
         ;;
      "CC="*)
         CC=`expr substr "$1" 4 length "$1"`
         ;;
      "CFLAGS="*)
         CFLAGS=`expr substr "$1" 8 length "$1"`
         ;;
      *) usage
         exit 1
         ;;
   esac
   shift
done

if [ -d "${MPIR_DIR}/lib" ]; then
   MPIR_LIB_DIR="${MPIR_DIR}/lib"
   MPIR_INCLUDE_DIR="${MPIR_DIR}/include"
elif [ -d "${MPIR_DIR}/.libs" ]; then
   MPIR_LIB_DIR="${MPIR_DIR}/.libs"
   MPIR_INCLUDE_DIR="${MPIR_DIR}"
else
   echo "Invalid MPIR directory"
   exit 1
fi

if [ -d "${MPFR_DIR}/lib" ]; then
   MPFR_LIB_DIR="${MPFR_DIR}/lib"
   MPFR_INCLUDE_DIR="${MPFR_DIR}/include"
elif [ -d "${MPFR_DIR}/.libs" ]; then
   MPFR_LIB_DIR="${MPFR_DIR}/.libs"
   MPFR_INCLUDE_DIR="${MPFR_DIR}"
else
   echo "Invalid MPFR directory"
   exit 1
fi

if [ -d "${NTL_DIR}/lib" ]; then
   NTL_LIB_DIR="${NTL_DIR}/lib"
   NTL_INCLUDE_DIR="${NTL_DIR}/include"
else
   echo "Invalid NTL directory"
   exit 1
fi

if [ -d "${FLINT_DIR}/lib" ]; then
   FLINT_LIB_DIR="${FLINT_DIR}/lib"
   FLINT_INCLUDE_DIR="${FLINT_DIR}/include"
else
   echo "Invalid FLINT directory"
   exit 1
fi

if [ -z "$CFLAGS" ]; then
   CFLAGS="-O2 -g -ansi -pedantic -Wall -funroll-loops"
fi

if [ -z "$CC" ]; then
   CC=gcc
fi

if [ -z "$CXX" ]; then
   CXX=g++
fi

CFLAGS="$CFLAGS $REENTER -DFLINT_CPIMPORT=\\\"$FLINT_CPIMPORT\\\""

POINTS=points

echo "# This file is autogenerated by ./configure -- do not edit!" > Makefile
echo "" >> Makefile
echo "MPIR_LIB_DIR=$MPIR_LIB_DIR" >> Makefile
echo "MPIR_INCLUDE_DIR=$MPIR_INCLUDE_DIR" >> Makefile
echo "MPFR_LIB_DIR=$MPFR_LIB_DIR" >> Makefile
echo "MPFR_INCLUDE_DIR=$MPFR_INCLUDE_DIR" >> Makefile
echo "NTL_LIB_DIR=$NTL_LIB_DIR" >> Makefile
echo "NTL_INCLUDE_DIR=$NTL_INCLUDE_DIR" >> Makefile
echo "FLINT_LIB_DIR=$FLINT_LIB_DIR" >> Makefile
echo "FLINT_INCLUDE_DIR=$FLINT_INCLUDE_DIR" >> Makefile
echo "FLINT_CPIMPORT_DIR=$FLINT_CPIMPORT_DIR" >> Makefile
echo "FLINT_CPIMPORT=$FLINT_CPIMPORT" >> Makefile
echo "" >> Makefile
echo "CC=$CC" >> Makefile
echo "CXX=$CXX" >> Makefile
echo "CFLAGS=$CFLAGS" >> Makefile
echo "PREFIX=$PREFIX" >> Makefile
echo "" >> Makefile
echo "POINTS=$POINTS" >> Makefile
echo "" >> Makefile

cat Makefile.in >> Makefile

